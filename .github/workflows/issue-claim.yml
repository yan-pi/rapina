name: Issue Claim

on:
  issue_comment:
    types: [created]

permissions: {}

jobs:
  claim:
    name: Assign issue
    if: >-
      !github.event.issue.pull_request &&
      (contains(github.event.comment.body, '/take') || contains(github.event.comment.body, '/claim') || contains(github.event.comment.body, '/release'))
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Assign commenter
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea  # v7
        with:
          script: |
            const body = context.payload.comment.body.trim();
            const commenter = context.payload.comment.user.login;
            const issue = context.issue;

            if (body.includes('/release')) {
              await github.rest.issues.removeAssignees({
                owner: issue.owner,
                repo: issue.repo,
                issue_number: issue.number,
                assignees: [commenter],
              });
              return;
            }

            try {
              await github.rest.issues.addAssignees({
                owner: issue.owner,
                repo: issue.repo,
                issue_number: issue.number,
                assignees: [commenter],
              });
            } catch (error) {
              await github.rest.issues.createComment({
                owner: issue.owner,
                repo: issue.repo,
                issue_number: issue.number,
                body: `@${commenter} I couldn't assign you directly (GitHub permissions), but consider this claimed! A maintainer will assign you shortly.`,
              });
            }
